from apps.core.constants import get_month_name, get_month_number, format_date
from apps.core.models import UserActionLog
from apps.users.models import User
from apps.attendances.models import ChurchService, ServiceAttendanceMetric
from apps.membership.models import Branch


user = User.objects.filter(username="admin").first()

records = [{"branch":5,"service":3,"service_date":"2025-03-26","total_present":903,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-06-14","total_present":382,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-04-21","total_present":1602,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-09-23","total_present":211,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-05-24","total_present":574,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-10-30","total_present":1731,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-07-05","total_present":1807,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-01-07","total_present":1088,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-03-19","total_present":420,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-06-29","total_present":597,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-08-06","total_present":1816,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-07-14","total_present":1202,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-06-22","total_present":1725,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-07-01","total_present":1856,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2025-04-28","total_present":1600,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-04-21","total_present":1989,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-11-29","total_present":1916,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-12-08","total_present":1035,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-07-15","total_present":376,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-09-16","total_present":1924,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-09-28","total_present":423,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-08-26","total_present":357,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2023-09-05","total_present":1575,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-09-04","total_present":1285,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-04-24","total_present":1560,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-05-17","total_present":1074,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-04-17","total_present":720,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-01-17","total_present":1476,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-08-22","total_present":155,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-02-20","total_present":636,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-07-21","total_present":289,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-09-16","total_present":1660,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-09-05","total_present":445,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-08-07","total_present":1055,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-10-21","total_present":282,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-02-06","total_present":360,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-10-13","total_present":401,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-05-02","total_present":1837,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-10-05","total_present":1576,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-05-07","total_present":1438,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2023-01-26","total_present":1340,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-05-24","total_present":850,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2023-10-14","total_present":1591,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-11-09","total_present":1223,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2023-05-05","total_present":750,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2025-06-10","total_present":500,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-09-09","total_present":238,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-01-02","total_present":363,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-02-04","total_present":1066,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-12-20","total_present":1176,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-11-09","total_present":1367,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-08-19","total_present":377,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-01-20","total_present":1793,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-06-25","total_present":1469,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-03-30","total_present":716,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-08-20","total_present":1014,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2023-08-10","total_present":1591,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-06-28","total_present":1416,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-08-28","total_present":1433,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-04-08","total_present":1873,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-03-15","total_present":922,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-07-16","total_present":898,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-05-28","total_present":1632,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-05-22","total_present":1129,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-03-24","total_present":1617,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-10-21","total_present":135,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2023-03-28","total_present":1111,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-11-02","total_present":896,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-05-01","total_present":1642,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-12-17","total_present":897,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-03-17","total_present":1205,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-06-01","total_present":1448,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-11-14","total_present":711,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-04-24","total_present":273,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2025-05-10","total_present":1651,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-02-26","total_present":398,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-08-12","total_present":390,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-11-29","total_present":409,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2025-03-02","total_present":1540,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-08-16","total_present":1654,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-07-08","total_present":395,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-04-06","total_present":866,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-03-24","total_present":720,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-03-30","total_present":1744,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2025-03-31","total_present":1216,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-09-04","total_present":922,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-05-21","total_present":1598,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-03-10","total_present":1818,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-03-11","total_present":126,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-02-15","total_present":306,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-06-24","total_present":1171,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-06-04","total_present":1674,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-09-03","total_present":909,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-03-16","total_present":421,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-11-03","total_present":519,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-05-11","total_present":1827,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-07-27","total_present":485,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-04-10","total_present":302,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-07-19","total_present":1117,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-10-09","total_present":112,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-08-18","total_present":1864,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2025-02-20","total_present":918,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-08-09","total_present":1750,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-08-31","total_present":1626,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-01-27","total_present":328,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-07-01","total_present":1683,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-01-06","total_present":1276,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-06-09","total_present":307,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2025-08-29","total_present":674,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-09-04","total_present":1033,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-09-15","total_present":1268,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-06-12","total_present":669,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-12-12","total_present":1196,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2025-08-11","total_present":1511,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-10-12","total_present":245,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2025-09-25","total_present":847,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-02-18","total_present":703,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-02-10","total_present":560,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-07-11","total_present":741,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-08-31","total_present":563,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-06-19","total_present":789,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-04-12","total_present":155,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-02-19","total_present":749,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-02-18","total_present":365,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-05-11","total_present":1304,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-02-23","total_present":1276,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2025-06-21","total_present":1918,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-04-23","total_present":1932,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-09-30","total_present":136,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-05-05","total_present":217,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2025-04-01","total_present":1762,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-02-20","total_present":1018,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-04-10","total_present":643,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2025-08-03","total_present":1370,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-03-05","total_present":1072,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-10-06","total_present":1488,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-02-02","total_present":1344,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-04-26","total_present":347,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-04-17","total_present":974,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-04-05","total_present":1571,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-09-16","total_present":135,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-04-13","total_present":639,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-05-20","total_present":485,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2023-07-24","total_present":1164,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2025-09-02","total_present":1979,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2025-07-15","total_present":1582,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-10-23","total_present":990,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-09-07","total_present":1804,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-05-02","total_present":1524,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-12-25","total_present":1251,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-05-18","total_present":1009,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-02-16","total_present":1733,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-01-21","total_present":886,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2025-02-24","total_present":1933,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-11-12","total_present":1792,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-12-17","total_present":575,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-06-23","total_present":174,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-08-19","total_present":336,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2025-01-14","total_present":574,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2023-10-02","total_present":1065,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2025-02-27","total_present":966,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-12-09","total_present":1162,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2024-11-21","total_present":1468,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-02-12","total_present":1719,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2025-01-10","total_present":200,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-10-01","total_present":1759,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-03-05","total_present":938,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-10-30","total_present":1271,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2023-05-11","total_present":681,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-05-30","total_present":1540,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2024-01-10","total_present":1292,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-12-07","total_present":574,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-04-23","total_present":1810,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-07-22","total_present":1776,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-10-23","total_present":1224,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-09-19","total_present":377,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-09-15","total_present":1350,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2025-07-19","total_present":962,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-11-29","total_present":1782,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-06-30","total_present":1031,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-06-07","total_present":420,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-11-25","total_present":1629,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2023-10-01","total_present":1586,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-04-09","total_present":1085,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-11-20","total_present":1656,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-08-18","total_present":514,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-08-21","total_present":833,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2024-12-06","total_present":496,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-11-18","total_present":185,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2023-01-20","total_present":713,"gender":"Female"},
{"branch":5,"service":3,"service_date":"2024-03-01","total_present":1575,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-05-13","total_present":1609,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2023-08-31","total_present":1418,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-04-19","total_present":1390,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2023-02-13","total_present":119,"gender":"Female"},
{"branch":5,"service":2,"service_date":"2025-07-18","total_present":304,"gender":"Male"},
{"branch":5,"service":2,"service_date":"2023-08-13","total_present":791,"gender":"Female"},
{"branch":5,"service":1,"service_date":"2023-02-02","total_present":1753,"gender":"Male"},
{"branch":5,"service":3,"service_date":"2024-10-29","total_present":954,"gender":"Male"},
{"branch":5,"service":1,"service_date":"2024-10-09","total_present":291,"gender":"Female"}]

def load_attendances():
    for record in records:
        branch_id = record.get("branch")
        service_id = record.get("service")
        service_date = record.get("service_date")
        total_present = record.get("total_present")
        gender = record.get("gender")

        date_obj = format_date(service_date)

        branch = Branch.objects.get(id=branch_id)
        service = ChurchService.objects.get(id=service_id)

        metric_log = ServiceAttendanceMetric.objects.filter(
            branch=branch, service=service, service_date=date_obj, gender=gender
        ).first()

        if metric_log:
            metric_log.total_present += int(total_present)
            metric_log.save()
        else:
            metric_log = ServiceAttendanceMetric.objects.create(
                branch=branch,
                service=service,
                total_present=total_present,
                service_date=date_obj,
                gender=gender,
                recorded_by=user
            )
            metric_log.month = get_month_name(date_obj.month)
            metric_log.year = date_obj.year
            metric_log.save()

        UserActionLog.objects.create(
            user=user,
            action_type="Record Service Attendance",
            action_description=f"Recorded attendance for {service.name} on {service_date} at {branch.name}",
            metadata={
                "branch_id": branch.id,
                "branch_name": branch.name,
                "service_id": service.id,
                "service_name": service.name,
                "service_date": service_date,
                "total_present": total_present,
                "recorded_by": user.username
            },
        )
